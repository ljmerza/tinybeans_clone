# Story 1.3: Frontend Admin Invitation Experience

## Status
- Ready for Review

## Story
**As a** circle admin using the web app,  
**I want** an intuitive invite UI with status tracking,  
**so that** I can manage invitations without leaving the circles dashboard.

## Acceptance Criteria
1. Invite modal/panel allows searching by username/email, displaying existence state and validation errors.  
2. Pending invitation list surfaces statuses (pending, accepted, declined, expired) with resend/cancel controls.  
3. UI leverages shared components (Button, Input, Badge, Toast) in line with design tokens.  
4. Error handling provides actionable messages without exposing backend details.

## Tasks / Subtasks
- [x] Implement invite creation modal/panel using shared components (AC 1, AC 3)  
  - [x] Add username/email search integration with new backend endpoints and optimistic UX (AC 1)  
- [x] Build pending invitations list UI with status badges and resend/cancel actions (AC 2)  
- [x] Hook TanStack Query mutations/queries for invite create, list, resend, cancel (AC 2)  
- [x] Ensure toast/error handling aligns with existing patterns (`web/src/components/toast`) (AC 3, AC 4)  

## Dev Notes
- Frontend resides in `web/`; circles feature modules live under `web/src/features/circles`.  
- Shared UI primitives (Button, Input, Badge, Dialog) are in `web/src/components`; adhere to tokens defined in `web/components.json` (to be refreshed in new docs).  
- Use TanStack Query for server interactions; maintain caching keys consistent with existing membership queries.  
- Invite status API responses should reflect backend schema updates (pending/accepted/etc.); map them to badges and user messaging.  
- Keep the admin experience within current routes (`web/src/routes` & `route-views`), respecting navigation patterns.  
- Feature flag or gracefully degrade UI if backend capability is absent (for deploy staging).

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-02-14 | 0.1 | Initial draft | BMad Master |
| 2025-02-18 | 1.0 | Frontend invite dashboard implemented | Codex |

## Dev Agent Record
- **Agent**: James (Codex)
- **Summary**: Implemented the circles dashboard invite manager with TanStack Query hooks, invite form, and pending list UI integrating resend/cancel actions and shared styling.
- **Tests**:
  - `npm run lint` (pass)
  - `npx vitest run src/features/circles/components/CircleInvitationForm.test.tsx src/features/circles/components/CircleInvitationList.test.tsx` (fails: Vitest exits immediately with code 1 without diagnostics in this environment; follow-up needed when tooling is available.)

### Agent Model Used
- GPT-5 Codex (default)

### Debug Log References
- `.ai/debug-log.md` (2025-02-18 entry)

### Completion Notes
- Added invite creation form with username/email lookup, role selection, and inline feedback states.
- Built invitation list with status badges, resend/cancel mutations, and localized timestamps.
- Introduced circles index and dashboard routes to host the admin invitation experience and navigation entry.
- Authenticated header now links to the circles dashboard for admins.
- Updated i18n wiring so `/circles` and invite components resolve strings via `pages.circles.*` namespace with English/Spanish resources.
- Authored Vitest component specs for invite form and list behaviours; execution blocked locally as noted above.

### File List
- `.ai/debug-log.md`
- `web/src/features/circles/types.ts`
- `web/src/features/circles/api/queryKeys.ts`
- `web/src/features/circles/api/services.ts`
- `web/src/features/circles/hooks/useCircleInvitationAdmin.ts`
- `web/src/features/circles/hooks/useCircleMemberships.ts`
- `web/src/features/circles/components/CircleInvitationForm.tsx`
- `web/src/features/circles/components/CircleInvitationList.tsx`
- `web/src/features/circles/components/CircleInvitationManager.tsx`
- `web/src/features/circles/components/CircleInvitationForm.test.tsx`
- `web/src/features/circles/components/CircleInvitationList.test.tsx`
- `web/src/features/circles/components/index.ts`
- `web/src/components/ui/badge.tsx`
- `web/src/components/Header.tsx`
- `web/src/i18n/locales/en.json`
- `web/src/features/circles/index.ts`
- `web/src/route-views/circles/index.tsx`
- `web/src/route-views/circles/dashboard.tsx`
- `web/src/routes/circles/index.tsx`
- `web/src/routes/circles/$circleId.tsx`

## QA Results
*(To be completed by QA agent.)*
