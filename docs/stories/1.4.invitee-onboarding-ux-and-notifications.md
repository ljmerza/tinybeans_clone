# Story 1.4: Invitee Onboarding UX and Notifications

## Status
- Ready for Review

## Story
**As a** circle invitee,  
**I want** a clear onboarding/acceptance experience,  
**so that** I know when I’ve joined the circle and what to do next.

## Acceptance Criteria
1. React onboarding flow handles magic-link and OAuth callbacks, prompting for 2FA where required.  
2. Pending/accepted/declined/expired paths each show distinct screens following existing UX patterns.  
3. Toasts and emails confirm acceptance or decline; admins receive in-app notifications when invite status changes.  
4. Analytics/logging capture invite acceptance funnel events for future metrics.

## Tasks / Subtasks
- [x] Implement invite landing/acceptance pages handling magic link & OAuth callbacks (AC 1)  
  - [x] Integrate 2FA prompts when backend signals requirement (AC 1)  
- [x] Build UX for accepted/declined/expired states with reusable components (AC 2)  
- [x] Trigger toast notifications and wire in-app notifications via existing stores (AC 3)  
- [x] Coordinate with backend to emit events/logs and capture client analytics hooks (AC 3, AC 4)  
- [x] Write Vitest coverage for state flows and snapshot key UI states (All ACs)

## Dev Notes
- Onboarding routes should live under `web/src/routes` (and `route-views`) using TanStack Router; ensure deep links from emails work.  
- Use existing authentication hooks/utilities in `web/src/features/auth` to coordinate with backend tokens.  
- Toasts come from `web/src/components/toast`; in-app notifications likely tie into messaging/notification store (validate existing pattern).  
- Email templates triggered by backend; ensure UI copy matches template messaging for consistency.  
- Add analytics instrumentation using current telemetry approach (check `web/src/lib/` or `integrations` for event emitter).  
- Provide graceful fallback for expired/invalid tokens with links to contact support.  
- Respect localization/i18n patterns defined in `web/src/i18n`.

### Testing
- Vitest + React Testing Library for flow coverage; mock router navigation and auth hooks.  
- Consider contract tests with backend schema to ensure UI handles all status values.  
- Run `npm run test`, `npm run lint`, `npm run format` to maintain CI cleanliness.

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-02-14 | 0.1 | Initial draft | BMad Master |
| 2025-02-19 | 1.0 | Invitee onboarding UX implemented with analytics/tests | Codex |

## Dev Agent Record
- **Agent**: James (Codex)
- **Summary**: Delivered invitee onboarding routes with pending/accepted/declined/expired states, auth-aware redirects (login, signup, magic link, Google OAuth, 2FA), analytics taps, and storage synchronization for cross-flow completion.
- **Tests**:
  - `npm run lint`
  - `npx vitest run src/route-views/invitations/accept.test.tsx` *(fails: Vitest exits immediately without diagnostics in this environment—matches prior known issue from Story 1.3)*

## QA Results
*(To be completed by QA agent.)*
